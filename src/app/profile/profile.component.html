@if (displayUser$ | async; as user) {
  <div class="page profile-page">
    <div class="profile-header card">
      <div class="profile-banner">
        @if (hasBackgroundImage) {
          <img class="profile-banner__img" [src]="user?.backgroundImageURL" alt="User Background">
        } @else {
          <div class="profile-banner__empty" aria-hidden="true"></div>
        }
      </div>

      <div class="profile-header__row">
        <img class="profile-avatar" [src]="userPhotoUrl" alt="Profile Picture"/>

        <div class="profile-actions">
          @if (loggedInUserId === currentUserId) {
            <button class="profile-action" mat-mini-fab (click)="openProfileEditor()">
              Edit Profile
              <mat-icon>edit</mat-icon>
            </button>
          }
          @if (loggedInUserId !== currentUserId && !isFollowing) {
            <button class="profile-action" mat-mini-fab (click)="follow()">
              Follow
              <mat-icon>person_add</mat-icon>
            </button>
          }
          @if (loggedInUserId !== currentUserId && isFollowing) {
            <button
              class="profile-action"
              mat-mini-fab
              (click)="unfollow()"
              [ngClass]="{'followed': isFollowing}"
            >
              Unfollow
              <mat-icon>person_remove</mat-icon>
            </button>
          }
        </div>
      </div>

      <div class="profile-stats">
        <h1><b>&#64;{{ user?.username }}</b></h1>
        <p><b>Following: {{ user?.followingCount ?? 0 }} Â· Followers: {{ user?.followerCount ?? 0}}</b></p>
      </div>
    </div>

    <div class="profile-bio card">
      <h2><b>Bio</b></h2>
      @if (hasBio) {
        <p>{{ user?.bio }}</p>
      } @else {
        <p class="muted">No bio yet.</p>
      }
    </div>

    <div class="profile-navbar card" role="navigation" aria-label="Profile sections">
      <button type="button">Posts</button>
      <button type="button" disabled>Likes</button>
      <button type="button" disabled>Replies</button>
      <button type="button" disabled>Reposts</button>
      <button type="button" disabled>Highlights</button>
    </div>

    <div class="user-posts">
      <app-profile-posts [posts]="userPosts"></app-profile-posts>
    </div>

    @if (isLoadingPosts) {
      <div class="loading-spinner"></div>
      <div class="loading-posts">
        Loading Posts...
      </div>
    }
  </div>
}

@if (isProfileEditorOpen) {
  <app-profile-editor (close)="closeProfileEditor()"></app-profile-editor>
}